# FProject ì¸í”„ë¼ (Terraform)

AWS ê¸°ë°˜ í’€ìŠ¤íƒ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ì¸í”„ë¼ë¥¼ Terraformìœ¼ë¡œ ê´€ë¦¬í•©ë‹ˆë‹¤.

## ğŸ“‹ ì•„í‚¤í…ì²˜ ê°œìš”

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                    AWS                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                              VPC (10.0.0.0/16)                         â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚  â”‚
â”‚  â”‚   â”‚   Public Subnet     â”‚         â”‚   Public Subnet     â”‚             â”‚  â”‚
â”‚  â”‚   â”‚   (AZ-a)            â”‚         â”‚   (AZ-b)            â”‚             â”‚  â”‚
â”‚  â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚         â”‚                     â”‚             â”‚  â”‚
â”‚  â”‚   â”‚   â”‚ NAT Gateway â”‚   â”‚         â”‚                     â”‚             â”‚  â”‚
â”‚  â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚         â”‚                     â”‚             â”‚  â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚  â”‚
â”‚  â”‚              â”‚                              â”‚                          â”‚  â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚  â”‚
â”‚  â”‚   â”‚   Private Subnet    â”‚         â”‚   Private Subnet    â”‚             â”‚  â”‚
â”‚  â”‚   â”‚   (AZ-a)            â”‚         â”‚   (AZ-b)            â”‚             â”‚  â”‚
â”‚  â”‚   â”‚                     â”‚         â”‚                     â”‚             â”‚  â”‚
â”‚  â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”  â”‚         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”           â”‚             â”‚  â”‚
â”‚  â”‚   â”‚  â”‚ EKS  â”‚ â”‚ RDS  â”‚  â”‚         â”‚  â”‚ EKS  â”‚           â”‚             â”‚  â”‚
â”‚  â”‚   â”‚  â”‚ Node â”‚ â”‚(PG15)â”‚  â”‚         â”‚  â”‚ Node â”‚           â”‚             â”‚  â”‚
â”‚  â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜  â”‚         â”‚  â””â”€â”€â”€â”€â”€â”€â”˜           â”‚             â”‚  â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   Cognito   â”‚  â”‚    ECR      â”‚  â”‚     S3      â”‚  â”‚      Lambda         â”‚ â”‚
â”‚  â”‚  User Pool  â”‚  â”‚ (Container) â”‚  â”‚  (Frontend) â”‚  â”‚ (DB Table Creator)  â”‚ â”‚
â”‚  â”‚  (ê¸°ì¡´ì‚¬ìš©)  â”‚  â”‚             â”‚  â”‚             â”‚  â”‚                     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ—‚ï¸ í”„ë¡œì íŠ¸ êµ¬ì¡°

```
terraform/
â”œâ”€â”€ main.tf                 # ë©”ì¸ ì„¤ì • (ëª¨ë“ˆ í˜¸ì¶œ)
â”œâ”€â”€ variables.tf            # ë³€ìˆ˜ ì •ì˜
â”œâ”€â”€ outputs.tf              # ì¶œë ¥ê°’ ì •ì˜
â”œâ”€â”€ terraform.tfvars        # ë³€ìˆ˜ê°’ ì„¤ì • (ì§ì ‘ ìƒì„± í•„ìš”)
â”œâ”€â”€ terraform.tfvars.example
â””â”€â”€ modules/
    â”œâ”€â”€ vpc/                # ë„¤íŠ¸ì›Œí¬ ì¸í”„ë¼
    â”œâ”€â”€ rds/                # PostgreSQL ë°ì´í„°ë² ì´ìŠ¤
    â”œâ”€â”€ eks/                # Kubernetes í´ëŸ¬ìŠ¤í„°
    â”œâ”€â”€ ecr/                # ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ ì €ì¥ì†Œ
    â”œâ”€â”€ s3-website/         # í”„ë¡ íŠ¸ì—”ë“œ ì •ì  í˜¸ìŠ¤íŒ…
    â”œâ”€â”€ lambda-update/      # ê¸°ì¡´ Cognito Lambda ì—…ë°ì´íŠ¸
    â””â”€â”€ db-init/            # DB í…Œì´ë¸” ìƒì„± Lambda
```

## ğŸš€ ë°°í¬ ë°©ë²•

### 1. ì‚¬ì „ ì¤€ë¹„

```bash
# AWS CLI ì„¤ì • í™•ì¸
aws sts get-caller-identity

# Terraform ì„¤ì¹˜ í™•ì¸
terraform version
```

### 2. ë³€ìˆ˜ íŒŒì¼ ìƒì„±

```bash
cp terraform.tfvars.example terraform.tfvars
```

`terraform.tfvars` íŒŒì¼ì„ ì—´ì–´ ê°’ì„ ìˆ˜ì •í•˜ì„¸ìš”:

```hcl
# í•„ìˆ˜ ìˆ˜ì • í•­ëª©
db_password = "YOUR_SECURE_PASSWORD"  # ë°˜ë“œì‹œ ë³€ê²½!

# ì„ íƒ ìˆ˜ì • í•­ëª©
project_name = "fproject"
environment  = "dev"
aws_region   = "us-east-1"
```

### 3. ë°°í¬ ì‹¤í–‰

```bash
# ì´ˆê¸°í™”
terraform init

# ë³€ê²½ì‚¬í•­ í™•ì¸
terraform plan

# ë°°í¬ (ì•½ 15-20ë¶„ ì†Œìš”)
terraform apply
```

### 4. ë°°í¬ ê²°ê³¼ í™•ì¸

```bash
# ì¶œë ¥ê°’ í™•ì¸
terraform output

# kubeconfig ì„¤ì •
aws eks update-kubeconfig --region us-east-1 --name fproject-dev-eks
```

## ğŸ“¦ ìƒì„±ë˜ëŠ” ë¦¬ì†ŒìŠ¤

| ëª¨ë“ˆ | ë¦¬ì†ŒìŠ¤ | ì„¤ëª… |
|------|--------|------|
| VPC | VPC, Subnets, NAT GW, IGW | ë„¤íŠ¸ì›Œí¬ ì¸í”„ë¼ |
| RDS | PostgreSQL 15 (db.t3.micro) | ë°ì´í„°ë² ì´ìŠ¤ (í”„ë¦¬í‹°ì–´) |
| EKS | Kubernetes 1.34 í´ëŸ¬ìŠ¤í„° | ì»¨í…Œì´ë„ˆ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ |
| ECR | Docker ì´ë¯¸ì§€ ì €ì¥ì†Œ | API ì„œë²„ ì´ë¯¸ì§€ ê´€ë¦¬ |
| S3 | ì •ì  ì›¹ì‚¬ì´íŠ¸ ë²„í‚· | í”„ë¡ íŠ¸ì—”ë“œ í˜¸ìŠ¤íŒ… |
| Lambda | DB í…Œì´ë¸” ìƒì„± í•¨ìˆ˜ | ìë™ ìŠ¤í‚¤ë§ˆ ë§ˆì´ê·¸ë ˆì´ì…˜ |

## ğŸ—„ï¸ ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸”

ë°°í¬ ì‹œ ìë™ìœ¼ë¡œ ìƒì„±ë˜ëŠ” í…Œì´ë¸”:

| í…Œì´ë¸” | ì„¤ëª… |
|--------|------|
| `users` | ì‚¬ìš©ì ì •ë³´ (Cognito ì—°ë™) |
| `user_profiles` | ì‚¬ìš©ì í”„ë¡œí•„ í™•ì¥ ì •ë³´ |
| `user_reports` | ì‚¬ìš©ì ì‹ ê³  |
| `user_inquiries` | ë¬¸ì˜/ì§€ì› í‹°ì¼“ |

í…Œì´ë¸” ìŠ¤í‚¤ë§ˆ ë³€ê²½ ì‹œ:
```hcl
# terraform.tfvars
db_schema_version = "1.1.0"  # ë²„ì „ ë³€ê²½ í›„ terraform apply
```

## ğŸ”§ ì£¼ìš” ì¶œë ¥ê°’

```bash
# ë°°í¬ í›„ í™•ì¸ ê°€ëŠ¥í•œ ê°’ë“¤
terraform output eks_cluster_name        # EKS í´ëŸ¬ìŠ¤í„° ì´ë¦„
terraform output rds_endpoint            # RDS ì ‘ì† ì£¼ì†Œ
terraform output s3_website_endpoint     # í”„ë¡ íŠ¸ì—”ë“œ URL
terraform output ecr_repository_url      # ECR ì €ì¥ì†Œ URL
```

## âš ï¸ ì£¼ì˜ì‚¬í•­

1. **ë¹„ìš©**: EKS, NAT GatewayëŠ” í”„ë¦¬í‹°ì–´ ëŒ€ìƒì´ ì•„ë‹™ë‹ˆë‹¤
2. **ë¹„ë°€ë²ˆí˜¸**: `db_password`ëŠ” ë°˜ë“œì‹œ ì•ˆì „í•œ ê°’ìœ¼ë¡œ ë³€ê²½í•˜ì„¸ìš”
3. **ì‚­ì œ**: `terraform destroy` ì‹¤í–‰ ì‹œ ëª¨ë“  ë°ì´í„°ê°€ ì‚­ì œë©ë‹ˆë‹¤

## ğŸ—‘ï¸ ë¦¬ì†ŒìŠ¤ ì‚­ì œ

```bash
terraform destroy
```

## ğŸ“ ë¬¸ì œ í•´ê²°

### Lambda í…Œì´ë¸” ìƒì„± ì‹¤íŒ¨ ì‹œ
```bash
# ìˆ˜ë™ ì‹¤í–‰
aws lambda invoke \
  --function-name fproject-dev-db-table-creator \
  --payload '{"action":"create_tables"}' \
  response.json

# ë¡œê·¸ í™•ì¸
cat response.json
```

### EKS ì—°ê²° ì•ˆë  ë•Œ
```bash
aws eks update-kubeconfig --region us-east-1 --name fproject-dev-eks
kubectl get nodes
```
